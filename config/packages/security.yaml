security:
  providers:
    app_user_provider:
      entity:
        class: App\Entity\User
        property: phone

  firewalls:
    dev:
        pattern: ^/(_profiler|_wdt|assets|build)/
        security: false

    # ğŸ” PROTECTED API FIRST
    api:
        pattern: ^/api
        stateless: true
        provider: app_user_provider
        jwt: ~

    # ğŸ”“ PUBLIC PRODUCTS
    public_products:
        pattern: ^/api/products
        stateless: true
        security: false

    # ğŸ”“ AUTH (OTP)
    auth:
        pattern: ^/api/auth
        stateless: true
        security: false

  access_control:
      # ğŸ” Admin routes first (most specific)
      - { path: ^/api/admin, roles: ROLE_ADMIN }

      # ğŸ”“ Auth routes
      - { path: ^/api/auth, roles: PUBLIC_ACCESS }

      # ğŸ”“ Public product routes (if needed)
      - { path: ^/api/products$, roles: PUBLIC_ACCESS }

      # ğŸ” Everything else under /api requires login
      - { path: ^/api, roles: IS_AUTHENTICATED }

